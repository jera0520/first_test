{% extends "base.html" %}

{% block title %}추천 루틴 - SKINMATE{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/recommendations.css') }}">
{% endblock %}

{% block content %}
<div class="prescription-container">
    <div class="routine-tab-buttons">
        <button class="tab-button active" onclick="showRoutine('morning', this)">
            <img src="{{ url_for('static', filename='images/morning_icon.png') }}" alt="Morning Routine">
            <span>모닝 루틴</span>
        </button>
        <button class="tab-button" onclick="showRoutine('night', this)">
            <img src="{{ url_for('static', filename='images/night_icon.png') }}" alt="Night Routine">
            <span>나이트 루틴</span>
        </button>
    </div>
    <!-- 모닝 루틴 -->
    {% if recommendations and recommendations.morning_routine %}
    <div id="morning" class="routine-content">
        <div class="morning-routine-section">
            <div class="routine-header">
                <h2>{{ recommendations.morning_routine.title }}</h2>
                <p>{{ recommendations.morning_routine.description }}</p>
            </div>
            <img src="static\images\morning_line.png" class="morning_line_img">
            <div class="steps-container">
                
                {% for step in recommendations.morning_routine.steps %}
                <div class="step-card">
                    <div class="step-td">
                        <div class="step-title">{{ step.step_title }}</div>
                        <div class="step-description">{{ step.step_description }}</div>
                    </div>
                    {% if step.primary_recommendation %}
                    <div class="primary-product-card">
                        
                        <div class="product-content">
                            <div class="product-image-container">
                                {% if step.primary_recommendation.image_url %}
                                <img src="{{ step.primary_recommendation.image_url }}" alt="{{ step.primary_recommendation.name }}" class="product-image" onerror="this.style.display='none'">
                                {% else %}
                                <div class="product-image-placeholder"><span>이미지 없음</span></div>
                                {% endif %}
                                <div class="product-rank">{{ step.primary_recommendation.rank }}위</div>
                            </div>
                            <div class="product-info">
                                <div class="product-brand">{{ step.primary_recommendation.brand }}</div>
                                <div class="product-name">{{ step.primary_recommendation.name }}</div>
                                {% if step.primary_recommendation.product_url %}
                                <a href="{{ step.primary_recommendation.product_url }}" target="_blank" class="product-link">👀</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% if step.alternatives %}
                    <details class="alternatives-accordion">
                        <summary>다른 좋은 제품들도 있어요</summary>
                        <div class="alternatives-list">
                            {% for alt_product in step.alternatives %}
                            <div class="alternative-item">
                                {% if alt_product.image_url %}
                                <img src="{{ alt_product.image_url }}" alt="{{ alt_product.name }}" class="alternative-image" onerror="this.style.display='none'">
                                {% else %}
                                <div class="alternative-image-placeholder"><span>이미지 없음</span></div>
                                {% endif %}
                                <div class="alternative-info">
                                    <div class="alternative-brand">{{ alt_product.brand }}</div>
                                    <div class="alternative-name">{{ alt_product.name }}</div>
                                    <div class="alternative-rank">랭킹 {{ alt_product.rank }}위</div>
                                </div>
                                {% if alt_product.product_url %}
                                <a href="{{ alt_product.product_url }}" target="_blank" class="product-link small">👀</a>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </details>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- 나이트 루틴 -->
    {% if recommendations.night_routine %}
    <div id="night" class="routine-content" style="display:none">
        <div class="night-routine-section">
            <div class="routine-header night">
                <h2>{{ recommendations.night_routine.title }}</h2>
                <p>{{ recommendations.night_routine.description }}</p>
            </div>
            <img src="static\images\night_line.png" class="night_line_img">
            <div class="steps-container">
                {% for step in recommendations.night_routine.steps %}
                <div class="step-card night">
                    <div class="step-td night">
                        <div class="step-title night">{{ step.step_title }}</div>
                        <div class="step-description night">{{ step.step_description }}</div>
                    </div>
                    {% if step.primary_recommendation %}
                    <div class="primary-product-card night">                        
                        <div class="product-content night">
                            <div class="product-image-container night">
                                {% if step.primary_recommendation.image_url %}
                                <img src="{{ step.primary_recommendation.image_url }}" alt="{{ step.primary_recommendation.name }}" class="product-image" onerror="this.style.display='none'">
                                {% else %}
                                <div class="product-image-placeholder"><span>이미지 없음</span></div>
                                {% endif %}
                                <div class="product-rank">{{ step.primary_recommendation.rank }}위</div>
                            </div>
                            <div class="product-info">
                                <div class="product-brand">{{ step.primary_recommendation.brand }}</div>
                                <div class="product-name">{{ step.primary_recommendation.name }}</div>
                                {% if step.primary_recommendation.product_url %}
                                <a href="{{ step.primary_recommendation.product_url }}" target="_blank" class="product-link">👀</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% if step.alternatives %}
                    <details class="alternatives-accordion">
                        <summary>다른 좋은 제품들도 있어요</summary>
                        <div class="alternatives-list">
                            {% for alt_product in step.alternatives %}
                            <div class="alternative-item">
                                {% if alt_product.image_url %}
                                <img src="{{ alt_product.image_url }}" alt="{{ alt_product.name }}" class="alternative-image" onerror="this.style.display='none'">
                                {% else %}
                                <div class="alternative-image-placeholder"><span>이미지 없음</span></div>
                                {% endif %}
                                <div class="alternative-info">
                                    <div class="alternative-brand">{{ alt_product.brand }}</div>
                                    <div class="alternative-name">{{ alt_product.name }}</div>
                                    <div class="alternative-rank">랭킹 {{ alt_product.rank }}위</div>
                                </div>
                                {% if alt_product.product_url %}
                                <a href="{{ alt_product.product_url }}" target="_blank" class="product-link small">👀</a>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </details>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 기본으로 모닝 루틴을 보여줍니다.
    document.getElementById('morning').style.display = 'block';
    document.getElementById('night').style.display = 'none';
    document.querySelector('main.centered-content').style.backgroundColor = '#FFFFF8';

    // 첫번째 탭 버튼을 활성화 상태로 만듭니다.
    var firstTab = document.querySelector('.tab-button');
    if(firstTab) {
        firstTab.classList.add('active');
    }
});

function showRoutine(routineName, elmnt) {
    var i, routineContent, tabButtons;
    routineContent = document.getElementsByClassName("routine-content");
    for (i = 0; i < routineContent.length; i++) {
        routineContent[i].style.display = "none";
    }

    tabButtons = document.getElementsByClassName("tab-button");
    for (i = 0; i < tabButtons.length; i++) {
        tabButtons[i].classList.remove("active");
    }

    document.getElementById(routineName).style.display = "block";
    elmnt.classList.add("active");

    const mainContent = document.querySelector('main.centered-content');
    if (routineName === 'morning') {
        mainContent.style.backgroundColor = '#FFFFF8';
        mainContent.classList.remove('night-theme');
    } else if (routineName === 'night') {
        mainContent.style.backgroundColor = '#221A46';
        mainContent.classList.add('night-theme');
    }
}
</script>
{% endblock %}