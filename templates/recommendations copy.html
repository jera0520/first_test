{% extends "base.html" %}

{% block title %}AI í”¼ë¶€ ë¶„ì„ ê²°ê³¼ - SKINMATE{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/recommendations.css') }}">
{% endblock %}

{% block content %}
<div class="prescription-container">
    <!-- ì‚¬ìš©ì ì •ë³´ ì¹´ë“œ -->
    {% if recommendations and recommendations.user_info %}
    <div class="user-info-card">
        <img src="{{ url_for('static', filename='images/logo_icon_img.jpg') }}" alt="SKINMATE Logo" class="prescription-logo">
        <h2>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspAI í”¼ë¶€ ë¶„ì„ ê²°ê³¼&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h2>
        <p class="username">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<span class="rt_user_name">{{ recommendations.user_info.username }}</span>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<span class="rt_user_name_nim">ë‹˜</span></p>
        <p class="skin-type-label">í”¼ë¶€ íƒ€ì…ì€&nbsp;&nbsp;&nbsp;<span class="skin-type-highlight">{{ skin_type }}</span>&nbsp;&nbsp;&nbsp;ì…ë‹ˆë‹¤</p>
        <div class="my-type-icon">
            {% if scores %}
                <span class="score-item">ìˆ˜ë¶„ 
                    {% if scores.moisture is not none %}
                        <img src="{{ url_for('static', filename='images/' + get_face_icon(scores.moisture)) }}" alt="ìˆ˜ë¶„ ì ìˆ˜ ì•„ì´ì½˜" class="score-face-icon">
                    {% endif %}
                </span>
                <span class="score-item">íƒ„ë ¥ 
                    {% if scores.elasticity is not none %}
                        <img src="{{ url_for('static', filename='images/' + get_face_icon(scores.elasticity)) }}" alt="íƒ„ë ¥ ì ìˆ˜ ì•„ì´ì½˜" class="score-face-icon">
                    {% endif %}
                </span>
                <span class="score-item">ì£¼ë¦„ 
                    {% if scores.wrinkle is not none %}
                        <img src="{{ url_for('static', filename='images/' + get_face_icon(scores.wrinkle)) }}" alt="ì£¼ë¦„ ì ìˆ˜ ì•„ì´ì½˜" class="score-face-icon">
                    {% endif %}
                </span>
        </div>
            {% else %}
                <span>ë¶„ì„ ì ìˆ˜ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</span>
            {% endif %}
            <p class="prescription-date">
                <span class="date-num">{{ recommendations.user_info.date_info.year }}</span><span class="date-unit">ë…„</span>
                <span class="date-num">{{ recommendations.user_info.date_info.month }}</span><span class="date-unit">ì›”</span>
                <span class="date-num">{{ recommendations.user_info.date_info.day }}</span><span class="date-unit">ì¼</span>
            </p>
            <p class="drugstore-name">&nbsp&nbsp&nbspìŠ¤í‚¨ë©”ì´íŠ¸ì—°êµ¬ì†Œ&nbsp&nbsp&nbsp</p>
            <p class="all-dirtk"><span class="dirtk">ì—°êµ¬ì›</span>&nbsp&nbsp&nbsp&nbsp&nbsp<span class="dirtkdlfma">ê¹€í”¼ë¶€</span></p>
            <p>ê²½ìƒë¶ë„ ì•ˆë™ì‹œ ê²½ë™ë¡œ 1375</p>
            <p>TEL. 054)123-4567</p>
    </div>
</div>
    {% endif %}

    <button id="toggleInfoBtn" class="info-toggle-button">âš ï¸ ì‚¬ìš© ì „ ì•ˆë‚´ì‚¬í•­ì„ ê¼­ ì½ì–´ì£¼ì„¸ìš”</button>
    <div id="recommendationInfo" class="info-section hidden">
        <div class="qa-section">
            <h4>Only! ë‚˜ë§Œì„ ìœ„í•œ ì¶”ì²œì´ì—ìš”!</h4>
            <p>SKINMATEëŠ” ê·¸ëƒ¥ ì¸ê¸°ìˆœìœ¼ë¡œ ì œí’ˆì„ ì¶”ì²œí•˜ì§€ ì•Šì•„ìš”.<br>ìš°ë¦¬ í”¼ë¶€ ê³ ë¯¼, í”¼ë¶€ íƒ€ì…, ê·¸ë¦¬ê³  ê³„ì ˆì— ë§ëŠ” ì œí˜•ê¹Œì§€ ê¼¼ê¼¼í•˜ê²Œ ë”°ì ¸ì„œ ì§€ê¸ˆ ë‹¹ì‹ ì—ê²Œ ê°€ì¥ ì˜ ë§ëŠ” ì œí’ˆì„ ì•Œë ¤ë“œë ¤ìš”.</p>
        </div>
        <div class="tip-section">
            <h4>ğŸ’¡í”¼ë¶€ ê´€ë¦¬ íŒ</h4>
            <p>í”¼ë¶€ëŠ” ê¾¸ì¤€íˆ ê´€ë¦¬í•  ë•Œ ë” ì¢‹ì•„ì ¸ìš”.<br>30ì¼ ë’¤ì— ë‹¤ì‹œ ë¶„ì„í•´ì„œ ì–´ë–»ê²Œ ë‹¬ë¼ì¡ŒëŠ”ì§€ ê¼­ í™•ì¸í•´ë³´ì„¸ìš”!</p>
        </div>
        <div class="disclaimer-section">
            <h4>ì‚¬ìš© ì‹œ ìœ ì˜ì‚¬í•­</h4>
            <p>ë³¸ ì¶”ì²œì€ AI ê¸°ë°˜ ì§„ë‹¨ ê²°ê³¼ë¡œ, ì‹¤ì œ íš¨ëŠ¥ì€ ê°œì¸ì˜ í”¼ë¶€ ìƒíƒœ ë° ë°˜ì‘ì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ ìˆì–´ìš”.<br>íŠ¹ì • ì„±ë¶„ì— ì•Œë ˆë¥´ê¸°ê°€ ìˆìœ¼ì‹  ê²½ìš° ì œí’ˆ ì „ì„±ë¶„ì„ ë°˜ë“œì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
        </div>
    </div>

    <!-- ëª¨ë‹ ë£¨í‹´ -->
    {% if recommendations and recommendations.morning_routine %}
    <div class="morning-routine-section">
        <div class="routine-header">
            <h2>{{ recommendations.morning_routine.title }}</h2>
            <p>{{ recommendations.morning_routine.description }}</p>
        </div>
        
        <div class="steps-container">
            {% if recommendations.morning_routine.water_cleansing %}
            <div class="water-cleansing-info {% if not recommendations.morning_routine.water_cleansing.suitable %}not-suitable{% endif %}">
                <h4>{% if recommendations.morning_routine.water_cleansing.suitable %}ë¬¼ì„¸ì•ˆ ì í•©{% else %}ë¬¼ì„¸ì•ˆ ë¶€ì í•©{% endif %}</h4>
                <p>{{ recommendations.morning_routine.water_cleansing.reason }}</p>
            </div>
            {% endif %}
            
            {% for step in recommendations.morning_routine.steps %}
            <div class="step-card">
                <div class="step-title">{{ step.step_title }}</div>
                <div class="step-description">{{ step.step_description }}</div>
                
                {% if step.primary_recommendation %}
                <div class="primary-product-card">
                    <div class="primary-badge">ë§ì¶¤ ì¶”ì²œ</div>
                    <div class="product-content">
                        {% if step.primary_recommendation.image_url %}
                        <img src="{{ step.primary_recommendation.image_url }}" alt="{{ step.primary_recommendation.name }}" class="product-image" onerror="this.style.display='none'">
                        {% else %}
                        <div class="product-image-placeholder">
                            <span>ì´ë¯¸ì§€ ì—†ìŒ</span>
                        </div>
                        {% endif %}
                        
                        <div class="product-info">
                            <div class="product-brand">{{ step.primary_recommendation.brand }}</div>
                            <div class="product-name">{{ step.primary_recommendation.name }}</div>
                            <div class="product-rank">ë­í‚¹ {{ step.primary_recommendation.rank }}ìœ„</div>
                            <div class="product-reason">âœ¨ {{ step.primary_recommendation.reason }}</div>
                            
                            {% if step.primary_recommendation.product_url %}
                            <a href="{{ step.primary_recommendation.product_url }}" target="_blank" class="product-link">ì œí’ˆ ë³´ê¸°</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}
                
                {% if step.alternatives %}
                <details class="alternatives-accordion">
                    <summary>ë‹¤ë¥¸ ì¢‹ì€ ì œí’ˆë“¤ë„ ìˆì–´ìš”</summary>
                    <div class="alternatives-list">
                        {% for alt_product in step.alternatives %}
                        <div class="alternative-item">
                            {% if alt_product.image_url %}
                            <img src="{{ alt_product.image_url }}" alt="{{ alt_product.name }}" class="alternative-image" onerror="this.style.display='none'">
                            {% else %}
                            <div class="alternative-image-placeholder">
                                <span>ì´ë¯¸ì§€ ì—†ìŒ</span>
                            </div>
                            {% endif %}
                            
                            <div class="alternative-info">
                                <div class="alternative-brand">{{ alt_product.brand }}</div>
                                <div class="alternative-name">{{ alt_product.name }}</div>
                                <div class="alternative-rank">ë­í‚¹ {{ alt_product.rank }}ìœ„</div>
                            </div>
                            
                            {% if alt_product.product_url %}
                            <a href="{{ alt_product.product_url }}" target="_blank" class="product-link small">ë³´ê¸°</a>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </details>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- ë‚˜ì´íŠ¸ ë£¨í‹´ -->
    {% if recommendations and recommendations.night_routine %}
    <div class="night-routine-section">
        <div class="routine-header night">
            <h2>{{ recommendations.night_routine.title }}</h2>
            <p>{{ recommendations.night_routine.description }}</p>
        </div>
        
        <div class="steps-container">
            {% for step in recommendations.night_routine.steps %}
            <div class="step-card">
                <div class="step-title">{{ step.step_title }}</div>
                <div class="step-description">{{ step.step_description }}</div>
                
                {% if step.primary_recommendation %}
                <div class="primary-product-card">
                    <div class="primary-badge">ë§ì¶¤ ì¶”ì²œ</div>
                    <div class="product-content">
                        {% if step.primary_recommendation.image_url %}
                        <img src="{{ step.primary_recommendation.image_url }}" alt="{{ step.primary_recommendation.name }}" class="product-image" onerror="this.style.display='none'">
                        {% else %}
                        <div class="product-image-placeholder">
                            <span>ì´ë¯¸ì§€ ì—†ìŒ</span>
                        </div>
                        {% endif %}
                        
                        <div class="product-info">
                            <div class="product-brand">{{ step.primary_recommendation.brand }}</div>
                            <div class="product-name">{{ step.primary_recommendation.name }}</div>
                            <div class="product-rank">ë­í‚¹ {{ step.primary_recommendation.rank }}ìœ„</div>
                            <div class="product-reason">âœ¨ {{ step.primary_recommendation.reason }}</div>
                            
                            {% if step.primary_recommendation.product_url %}
                            <a href="{{ step.primary_recommendation.product_url }}" target="_blank" class="product-link">ì œí’ˆ ë³´ê¸°</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}
                
                {% if step.alternatives %}
                <details class="alternatives-accordion">
                    <summary>ë‹¤ë¥¸ ì¢‹ì€ ì œí’ˆë“¤ë„ ìˆì–´ìš”</summary>
                    <div class="alternatives-list">
                        {% for alt_product in step.alternatives %}
                        <div class="alternative-item">
                            {% if alt_product.image_url %}
                            <img src="{{ alt_product.image_url }}" alt="{{ alt_product.name }}" class="alternative-image" onerror="this.style.display='none'">
                            {% else %}
                            <div class="alternative-image-placeholder">
                                <span>ì´ë¯¸ì§€ ì—†ìŒ</span>
                            </div>
                            {% endif %}
                            
                            <div class="alternative-info">
                                <div class="alternative-brand">{{ alt_product.brand }}</div>
                                <div class="alternative-name">{{ alt_product.name }}</div>
                                <div class="alternative-rank">ë­í‚¹ {{ alt_product.rank }}ìœ„</div>
                            </div>
                            
                            {% if alt_product.product_url %}
                            <a href="{{ alt_product.product_url }}" target="_blank" class="product-link small">ë³´ê¸°</a>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </details>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- ì¶”ì²œ ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° -->
    {% if not recommendations %}
    <div class="no-products">
        <h3>ì•„ì§ ì¶”ì²œí•  ì œí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</h3>
        <p>í”¼ë¶€ ë¶„ì„ì„ ë¨¼ì € ì§„í–‰í•´ì£¼ì„¸ìš”.</p>
        <a href="/analysis" class="product-link">ë¶„ì„í•˜ê¸°</a>
    </div>
    {% endif %}
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const infoSection = document.getElementById('recommendationInfo');
        const toggleBtn = document.getElementById('toggleInfoBtn');

        toggleBtn.addEventListener('click', function() {
            infoSection.classList.toggle('hidden');
            if (infoSection.classList.contains('hidden')) {
                toggleBtn.textContent = 'âš ï¸ ì‚¬ìš© ì „ ì•ˆë‚´ì‚¬í•­ì„ ê¼­ ì½ì–´ì£¼ì„¸ìš”';
            } else {
                toggleBtn.textContent = 'ì•ˆë‚´ì‚¬í•­ ìˆ¨ê¸°ê¸°';
            }
        });
    });
</script>
{% endblock %}